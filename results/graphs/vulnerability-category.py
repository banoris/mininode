import pandas as pd
import plotly.express as px

data = pd.read_csv('../data/fixed-unique-advisories.csv')
data = data.sort_values(by=['high', 'medium', 'low'], ascending=False)
data = data.head(10)

total = data.drop(columns=['high', 'medium', 'low'])
total['severity'] = 'total'
total.rename(columns={'total': 'amount'}, inplace=True)

high = data.drop(columns=['medium', 'low', 'total'])
high['severity'] = 'high'
high.rename(columns={'high': 'amount'}, inplace=True)

medium = data.drop(columns=['high', 'low', 'total'])
medium['severity'] = 'medium'
medium.rename(columns={"medium": 'amount'}, inplace=True)

low = data.drop(columns=['high', 'medium', 'total'])
low['severity'] = 'low'
low.rename(columns={'low': 'amount'}, inplace=True)

result = pd.concat([total, high, medium, low])
print(result)
fig = px.bar(result, x='name', y='amount', color='severity', barmode='group', 
    labels={'name': 'Vulnerability Categories', 'amount': 'Number of dependended packages'}, log_y=True)

fig.show()